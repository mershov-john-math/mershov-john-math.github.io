<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>John Indent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        /* Custom scrollbar to match the spooky vibe */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Application Code -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icon Components (Inline SVGs to replace Lucide dependency) ---
        const SaveIcon = ({ size = 24, className = "" }) => (
            <svg 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
        );

        // --- The Monster Component ---
        const JohnIndent = ({ voidScore, maxDepth }) => {
            const [mood, setMood] = useState('sleeping');
            const [dialogue, setDialogue] = useState('');
            
            useEffect(() => {
                if (voidScore < 5) {
                    setMood('sleeping');
                    setDialogue('');
                } else if (voidScore >= 5 && voidScore < 15) {
                    setMood('waking');
                    setDialogue('...');
                } else if (voidScore >= 15 && voidScore < 30) {
                    setMood('watching');
                    setDialogue('I see empty space...');
                } else if (voidScore >= 30 && voidScore < 50) {
                    setMood('introducing');
                    setDialogue('I am John Indent.');
                } else if (voidScore >= 50 && voidScore < 80) {
                    setMood('hungry');
                    setDialogue('Push them right. Give me room to grow.');
                } else {
                    setMood('manic');
                    setDialogue('YES! THE VOID EXPANDS! MORE TAB! MORE!');
                }
            }, [voidScore]);

            const getOpacity = () => {
                if (mood === 'sleeping') return 0;
                if (mood === 'waking') return 0.2;
                if (mood === 'watching') return 0.5;
                return 0.9;
            };

            const getScale = () => {
                return 1 + (voidScore / 100);
            };

            const getPosition = () => {
                const base = -100;
                const progress = Math.min(maxDepth * 20, 300); 
                return base + progress;
            };

            return (
                <div 
                    className="fixed left-0 top-0 h-full pointer-events-none transition-all duration-1000 ease-in-out z-0 flex flex-col justify-center items-start"
                    style={{ 
                        width: '500px',
                        transform: `translateX(${mood === 'sleeping' ? '-200px' : '-50px'})`,
                        opacity: getOpacity(),
                        filter: mood === 'manic' ? 'contrast(1.5) hue-rotate(90deg)' : 'none'
                    }}
                >
                    {/* Dialogue Bubble */}
                    <div 
                        className={`ml-16 mb-4 p-4 rounded-tr-2xl rounded-bl-2xl rounded-tl-sm text-white font-mono text-sm border border-gray-600 transition-opacity duration-500 ${mood === 'sleeping' ? 'opacity-0' : 'opacity-100'}`}
                        style={{ 
                            background: 'rgba(20, 20, 20, 0.9)',
                            maxWidth: '250px',
                            boxShadow: '0 0 15px rgba(255, 0, 0, 0.1)'
                        }}
                    >
                        {dialogue}
                    </div>

                    {/* John Indent SVG Visuals */}
                    <svg viewBox="0 0 200 200" className="w-full h-full drop-shadow-2xl">
                        <defs>
                            <filter id="scribble">
                                <feTurbulence type="fractalNoise" baseFrequency="0.05" numOctaves="3" result="noise" />
                                <feDisplacementMap in="SourceGraphic" in2="noise" scale="5" />
                            </filter>
                        </defs>

                        <g filter="url(#scribble)" className={`transition-transform duration-1000`} style={{ transform: `scale(${getScale()})`, transformOrigin: 'left center' }}>
                            {/* Head/Body Shape */}
                            <path 
                                d="M-50,50 Q20,40 40,80 T80,150 T20,220 T-50,200 Z" 
                                fill="#1a1a1a" 
                                stroke="#333" 
                                strokeWidth="2"
                            />
                            
                            {/* Eyes */}
                            <g className={mood === 'manic' ? 'animate-pulse' : ''}>
                                <circle cx="30" cy="90" r={mood === 'waking' ? 2 : 6} fill="white" className="transition-all duration-500" />
                                <circle cx="30" cy="90" r={2} fill="red" className={mood === 'waking' ? 'opacity-0' : 'opacity-100'} />
                                
                                <circle cx="60" cy="85" r={mood === 'waking' ? 2 : 8} fill="white" className="transition-all duration-500" />
                                <circle cx="60" cy="85" r={3} fill="red" className={mood === 'waking' ? 'opacity-0' : 'opacity-100'} />
                            </g>

                            {/* Mouth */}
                            <path 
                                d={mood === 'manic' 
                                    ? "M20,130 Q45,160 70,120" 
                                    : "M30,130 Q45,135 60,130"} 
                                fill="none" 
                                stroke="white" 
                                strokeWidth="2" 
                                strokeLinecap="round"
                                className="transition-all duration-500"
                            />
                            
                            {/* Teeth */}
                            {(mood === 'hungry' || mood === 'manic') && (
                                <path d="M25,130 L30,140 L35,130 L40,145 L45,130 L50,140 L55,130" fill="none" stroke="white" strokeWidth="1" />
                            )}

                            {/* Hands/Tendrils */}
                            <path 
                                d="M60,160 C100,160 120,100 180,120" 
                                fill="none" 
                                stroke="#1a1a1a" 
                                strokeWidth="15" 
                                strokeLinecap="round"
                                className="transition-all duration-1000"
                                style={{ opacity: mood === 'hungry' || mood === 'manic' ? 1 : 0 }}
                            />
                        </g>
                    </svg>
                </div>
            );
        };

        // --- Editor Line Component ---
        const Block = ({ 
            item, 
            index, 
            updateBlock, 
            addBlock, 
            removeBlock, 
            focusBlock,
            inputRefs 
        }) => {
            
            const handleKeyDown = (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addBlock(index);
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    const direction = e.shiftKey ? -1 : 1;
                    const newLevel = Math.max(0, Math.min(12, item.level + direction)); 
                    updateBlock(item.id, { level: newLevel });
                } else if (e.key === 'Backspace' && item.text === '') {
                    e.preventDefault();
                    removeBlock(index);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    focusBlock(index - 1);
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    focusBlock(index + 1);
                }
            };

            return (
                <div 
                    className="group flex items-center py-1 transition-all duration-300"
                    style={{ 
                        paddingLeft: `${item.level * 2.5}rem`
                    }}
                >
                    <div className="mr-2 text-gray-400 select-none flex-shrink-0 relative">
                        <div className={`w-1.5 h-1.5 rounded-full bg-gray-800 transition-all ${item.level > 3 ? 'bg-red-900 scale-110' : ''}`} />
                    </div>
                    <input
                        ref={el => inputRefs.current[index] = el}
                        value={item.text}
                        onChange={(e) => updateBlock(item.id, { text: e.target.value })}
                        onKeyDown={handleKeyDown}
                        className="w-full bg-transparent outline-none text-gray-800 font-sans text-lg placeholder-gray-300 border-none focus:ring-0 p-0"
                        placeholder={index === 0 ? "Start typing..." : ""}
                        autoFocus={index === 0}
                    />
                </div>
            );
        };

        // --- Main App Component ---
        function App() {
            const [blocks, setBlocks] = useState([
                { id: Date.now(), text: 'Groceries', level: 0 },
                { id: Date.now() + 1, text: 'Milk', level: 1 },
                { id: Date.now() + 2, text: '', level: 1 },
            ]);

            const [voidScore, setVoidScore] = useState(0);
            const [maxDepth, setMaxDepth] = useState(0);

            const inputRefs = useRef([]);

            useEffect(() => {
                let score = 0;
                let depth = 0;
                blocks.forEach(b => {
                    score += b.level;
                    if (b.level > depth) depth = b.level;
                });
                setVoidScore(score);
                setMaxDepth(depth);
            }, [blocks]);

            const updateBlock = (id, newData) => {
                setBlocks(prev => prev.map(b => b.id === id ? { ...b, ...newData } : b));
            };

            const addBlock = (currentIndex) => {
                const currentBlock = blocks[currentIndex];
                const newBlock = {
                    id: Date.now(),
                    text: '',
                    level: currentBlock.level
                };
                
                const newBlocks = [...blocks];
                newBlocks.splice(currentIndex + 1, 0, newBlock);
                setBlocks(newBlocks);
                
                setTimeout(() => {
                    if (inputRefs.current[currentIndex + 1]) {
                        inputRefs.current[currentIndex + 1].focus();
                    }
                }, 0);
            };

            const removeBlock = (index) => {
                if (blocks.length <= 1) return;
                const newBlocks = blocks.filter((_, i) => i !== index);
                setBlocks(newBlocks);
                
                setTimeout(() => {
                    const prevIndex = index - 1 >= 0 ? index - 1 : 0;
                    if (inputRefs.current[prevIndex]) {
                        inputRefs.current[prevIndex].focus();
                    }
                }, 0);
            };

            const focusBlock = (index) => {
                if (index >= 0 && index < blocks.length) {
                    inputRefs.current[index].focus();
                }
            };

            const getBackgroundColor = () => {
                const darkness = Math.min(voidScore * 0.5, 20); 
                return `hsl(0, 0%, ${98 - darkness}%)`;
            };

            return (
                <div 
                    className="min-h-screen w-full transition-colors duration-1000 overflow-x-hidden relative"
                    style={{ backgroundColor: getBackgroundColor() }}
                >
                    <JohnIndent voidScore={voidScore} maxDepth={maxDepth} />

                    <div className="relative z-10 max-w-3xl mx-auto pt-20 px-12 pb-40 min-h-screen">
                        
                        <header className="mb-8 border-b border-gray-200 pb-4 flex justify-between items-center">
                            <div>
                                <h1 className="text-3xl font-bold text-gray-800 tracking-tight">Untitled Note</h1>
                                <p className="text-gray-400 text-sm mt-1">Press <kbd className="font-mono bg-gray-100 px-1 rounded">Tab</kbd> to indent</p>
                            </div>
                            <div className="flex gap-2">
                                <button className="p-2 hover:bg-gray-200 rounded-full text-gray-500 transition-colors">
                                    <SaveIcon size={20} />
                                </button>
                                <div className="h-6 w-px bg-gray-300 mx-2 self-center"></div>
                                <span className="text-xs text-gray-400 self-center font-mono">
                                    INDENT_LVL: {voidScore}
                                </span>
                            </div>
                        </header>

                        <div className="space-y-1">
                            {blocks.map((block, index) => (
                                <Block
                                    key={block.id}
                                    item={block}
                                    index={index}
                                    updateBlock={updateBlock}
                                    addBlock={addBlock}
                                    removeBlock={removeBlock}
                                    focusBlock={focusBlock}
                                    inputRefs={inputRefs}
                                />
                            ))}
                        </div>

                        <div 
                            className="h-40 cursor-text" 
                            onClick={() => {
                                if (blocks.length > 0) focusBlock(blocks.length - 1);
                            }}
                        />

                    </div>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
